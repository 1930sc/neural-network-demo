function checkSanity(){var t=[-.3180095069079748,-.2749093166215802,-.038532753589859546,.09576201205465842,-.3460678329225116,.23218797637289554,-.33191669283980774,.5140297481331861,-.1518989898989732],n=[-.3094657452311367,-.2758470894768834,.005968799814581871,.13201188389211893,-.33257930004037917,.24626848078332841,-.35734778200276196,.489376779878512,-.2165879353415221];sim.stop(),sim.config.inputLayer={neuronCount:2,names:["",""]},sim.config.hiddenLayers=[{neuronCount:2,activation:"sigmoid"}],sim.config.outputLayer={neuronCount:1,activation:"sigmoid",names:[""]},sim.net.connections.forEach(function(t,e){return t.weight=n[e]});for(var e=0;1e3>e;e++)sim.step();var i=sim.net.connections.map(function(t){return t.weight});if(i.every(function(n,e){return n!==t[e]}))throw"insanity!";return"ok"}var TableEditor=function(){function t(t){var n=this;this.headerCount=2,this.lastUpdate=0,this.createNewTable(t),$("<div>").addClass("btn btn-default").css({position:"absolute",right:"2em",bottom:"2em"}).text("Remove all").click(function(e){t.config.data=[],n.loadData(t)}).appendTo(this.container),this.loadData(t)}return t.prototype.afterChange=function(t,n){"loadData"!==n&&this.reparseData()},t.prototype.createNewTable=function(t){var n=this;this.hot&&this.hot.destroy();var e=this.container;this.container=$("<div class='fullsize'>");var i=function(t,n){Handsontable.renderers.TextRenderer.apply(this,arguments),n.style.fontWeight="bold",n.style.background="#CCC"},o=[],a=t.config.inputLayer.neuronCount,u=t.config.outputLayer.neuronCount;console.log("creating new table ("+a+", "+u+")"),a>1&&o.push({row:0,col:0,rowspan:1,colspan:a}),u>1&&(o.push({row:0,col:a,rowspan:1,colspan:u}),o.push({row:0,col:a+u,rowspan:1,colspan:u}));var r;r={minSpareRows:1,colWidths:6>=a+u+u?80:45,cells:function(t,e,o){if(t>=n.headerCount)return{type:"numeric",format:"0.[000]"};var a={renderer:i};return 0==t&&(a.readOnly=!0),a},customBorders:!1,allowInvalid:!1,mergeCells:o,afterChange:this.afterChange.bind(this)},console.log(r),this.container.handsontable(r),this.hot=this.container.handsontable("getInstance"),e&&e.replaceWith(this.container)},t.prototype.reparseData=function(){var t=this.hot.getData(),n=t[1],e=sim.config.inputLayer.neuronCount,i=sim.config.outputLayer.neuronCount;sim.config.inputLayer.names=n.slice(0,e),sim.config.outputLayer.names=n.slice(e,e+i),sim.config.data=t.slice(2).map(function(t){return t.slice(0,e+i)}).filter(function(t){return t.every(function(t){return"number"==typeof t})}).map(function(t){return{input:t.slice(0,e),output:t.slice(e)}}),sim.setIsCustom(!1,!1)},t.prototype.updateRealOutput=function(){if(!(Date.now()-this.lastUpdate<500)){this.lastUpdate=Date.now();for(var t=sim.config.inputLayer.neuronCount+sim.config.outputLayer.neuronCount,n=[],e=0;e<sim.config.data.length;e++)for(var i=sim.config.data[e],o=sim.net.getOutput(i.input),a=0;a<o.length;a++)n.push([e+this.headerCount,t+a,o[a]]);this.hot.setDataAtCell(n,"loadData")}},t.prototype.loadData=function(t){var n=[[],t.config.inputLayer.names.concat(t.config.outputLayer.names).concat(t.config.outputLayer.names)],e=t.config.inputLayer.neuronCount,i=t.config.outputLayer.neuronCount;n[0][0]="Inputs",n[0][e]="Expected Output",n[0][e+i+i-1]=" ",n[0][e+i]="Actual Output";var o=[];e>1&&o.push({row:0,col:0,rowspan:1,colspan:e}),i>1&&(o.push({row:0,col:e+i,rowspan:1,colspan:i}),o.push({row:0,col:e+2*i,rowspan:1,colspan:i})),o.length>0&&this.hot.updateSettings({mergeCells:o}),t.config.data.forEach(function(t){return n.push(t.input.concat(t.output))}),this.hot.loadData(n)},t}(),NeuronGui=function(){function t(t){var n=this;this.sim=t,this.layerDiv=$("#hiddenLayersModify > div").clone(),$("#hiddenLayersModify").on("click","button",function(n){var e="+"==n.target.textContent,i=$(n.target.parentNode).index(),o=t.config.hiddenLayers[i].neuronCount+(e?1:-1);1>o||(t.config.hiddenLayers[i].neuronCount=o,$("#hiddenLayersModify .neuronCount").eq(i).text(o),t.setIsCustom(!0),t.initializeNet())}),$("#inputLayerModify,#outputLayerModify").on("click","button",function(n){var e=$(n.target).closest("#inputLayerModify").length>0,i=e?"input":"output",o=e?t.config.inputLayer:t.config.outputLayer,a="+"==n.target.textContent,u=o.neuronCount+(a?1:-1);1>u||(o.neuronCount=u,$("#"+i+"LayerModify .neuronCount").text(u),t.config.data=[],t.setIsCustom(!0),t.initializeNet())}),$("#layerCountModifier").on("click","button",function(e){var i="+"==e.target.textContent;if(i)t.config.hiddenLayers.unshift({activation:"sigmoid",neuronCount:2}),n.addLayer();else{if(0==t.config.hiddenLayers.length)return;t.config.hiddenLayers.shift(),n.removeLayer()}$("#layerCount").text(t.config.hiddenLayers.length+2),t.setIsCustom(!1),t.initializeNet()}),$("#outputLayerModify").on("change","select",function(n){t.config.outputLayer.activation=n.target.value,t.setIsCustom(!1),t.initializeNet()}),$("#hiddenLayersModify").on("change","select",function(n){var e=$(n.target.parentNode).index();t.config.hiddenLayers[e].activation=n.target.value,t.setIsCustom(!1),t.initializeNet()})}return t.prototype.removeLayer=function(){$("#hiddenLayersModify > div").eq(0).remove()},t.prototype.addLayer=function(){$("#hiddenLayersModify > div").eq(0).before(this.layerDiv.clone())},t.prototype.setActivation=function(t,n){},t.prototype.regenerate=function(){for(var t=this.sim.config.hiddenLayers.length;$("#hiddenLayersModify > div").length>t;)this.removeLayer();for(;$("#hiddenLayersModify > div").length<t;)this.addLayer();this.sim.config.hiddenLayers.forEach(function(t,n){$("#hiddenLayersModify .neuronCount").eq(n).text(t.neuronCount),$("#hiddenLayersModify > div").eq(n).children("select.activation").val(t.activation)}),$("#inputLayerModify .neuronCount").text(this.sim.config.inputLayer.neuronCount),$("#outputLayerModify .neuronCount").text(this.sim.config.outputLayer.neuronCount),$("#layerCount").text(this.sim.config.hiddenLayers.length+2)},t}(),__extends=this.__extends||function(t,n){function e(){this.constructor=t}for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);e.prototype=n.prototype,t.prototype=new e},Net;!function(t){function n(t,n){if(void 0===t&&(t=0),void 0===n&&(n=1),void 0!==e){var i=e;return e=void 0,i*n+t}var o,a,u,r;do o=2*Math.random()-1,a=2*Math.random()-1,u=o*o+a*a;while(u>=1||0==u);return r=Math.sqrt(-2*Math.log(u)/u),e=a*r,o*r*n+t}var e;t.randomGaussian=n;var i,o=function(t){if(t===1/0)return 1;if(t===-(1/0))return-1;var n=Math.exp(2*t);return(n-1)/(n+1)},a={sigmoid:{f:function(t){return 1/(1+Math.exp(-t))},df:function(t){return t=1/(1+Math.exp(-t)),t*(1-t)}},tanh:{f:function(t){return o(t)},df:function(t){return t=o(t),1-t*t}},linear:{f:function(t){return t},df:function(t){return 1}}};!function(t){function n(t,n){for(var e=new Array(t),i=0;t>i;i++)e[i]=n(i);return e}t.makeArray=n}(i=t.Util||(t.Util={}));var u=function(){function n(n,e,o,a,u,r,c){var l=this;void 0===u&&(u=!0),void 0===r&&(r=function(){return Math.random()-.5}),this.learnRate=a,this.bias=u,this.startWeights=c,this.layers=[],this.connections=[];var d=0;this.inputs=i.makeArray(n.neuronCount,function(t){return new p(d++,n.names[t])}),this.layers.push(this.inputs.slice());for(var f=0;f<e.length;f++){var g=e[f];this.layers.push(i.makeArray(g.neuronCount,function(t){return new s(g.activation,d++)}))}this.outputs=i.makeArray(o.neuronCount,function(t){return new h(o.activation,d++,o.names[t])}),this.layers.push(this.outputs),this.bias=u;for(var y=0;y<this.layers.length-1;y++){var v=this.layers[y],m=this.layers[y+1];u&&v.push(new p(d++,"1 (bias)",1));for(var C=0;C<v.length;C++)for(var w=v[C],x=0;x<m.length;x++){var L=m[x],b=new t.NeuronConnection(w,L);w.outputs.push(b),L.inputs.push(b),this.connections.push(b)}}this.startWeights?this.startWeights.forEach(function(t,n){return l.connections[n].weight=t}):this.startWeights=this.connections.map(function(t){return t.weight=r()})}return n.prototype.setInputsAndCalculate=function(t){for(var n=0;n<this.inputs.length;n++)this.inputs[n].output=t[n];for(var e=0,i=this.layers.slice(1);e<i.length;e++)for(var o=i[e],a=0;a<o.length;a++){var u=o[a];u.calculateOutput()}},n.prototype.getOutput=function(t){return this.setInputsAndCalculate(t),this.outputs.map(function(t){return t.output})},n.prototype.train=function(t,n){this.setInputsAndCalculate(t);for(var e=0;e<this.outputs.length;e++)this.outputs[e].targetOutput=n[e];for(var i=this.layers.length-1;i>0;i--)for(var o=0,a=this.layers[i];o<a.length;o++){var u=a[o];u.calculateError();for(var r=0,s=u.inputs;r<s.length;r++){var p=s[r];p.calculateDeltaWeight(this.learnRate)}}for(var h=0,c=this.connections;h<c.length;h++){var p=c[h];p.weight+=p.deltaWeight}},n}();t.NeuralNet=u;var r=function(){function t(t,n){this.inp=t,this.out=n,this.deltaWeight=0,this.weight=0}return t.prototype.calculateDeltaWeight=function(t){this.deltaWeight=t*this.out.error*this.inp.output},t}();t.NeuronConnection=r;var s=function(){function t(t,n){this.activation=t,this.id=n,this.inputs=[],this.outputs=[],this.weightedInputs=0,this.output=0,this.error=0}return t.prototype.calculateWeightedInputs=function(){this.weightedInputs=0;for(var t=0,n=this.inputs;t<n.length;t++){var e=n[t];this.weightedInputs+=e.inp.output*e.weight}},t.prototype.calculateOutput=function(){this.calculateWeightedInputs(),this.output=a[this.activation].f(this.weightedInputs)},t.prototype.calculateError=function(){for(var t=0,n=0,e=this.outputs;n<e.length;n++){var i=e[n];t+=i.out.error*i.weight}this.error=t*a[this.activation].df(this.weightedInputs)},t}();t.Neuron=s;var p=function(t){function n(n,e,i){t.call(this,null,n),this.name=e,this.constant=!1,void 0!==i&&(this.output=i,this.constant=!0)}return __extends(n,t),n.prototype.calculateOutput=function(){},n.prototype.calculateWeightedInputs=function(){},n.prototype.calculateError=function(){},n}(s);t.InputNeuron=p;var h=function(t){function n(n,e,i){t.call(this,n,e),this.activation=n,this.name=i}return __extends(n,t),n.prototype.calculateError=function(){this.error=a[this.activation].df(this.weightedInputs)*(this.targetOutput-this.output)},n}(s);t.OutputNeuron=h}(Net||(Net={}));var NetworkGraph=function(){function t(t){this.networkGraphContainer=t,this.nodes=new vis.DataSet,this.edges=new vis.DataSet,this.instantiateGraph()}return t.prototype.instantiateGraph=function(){var t={nodes:this.nodes,edges:this.edges},n={nodes:{shape:"dot"},edges:{smooth:{type:"curvedCW",roundness:.2},font:{align:"top",background:"white"}},layout:{hierarchical:{direction:"LR"}},interaction:{dragNodes:!1}};this.graph=new vis.Network(this.networkGraphContainer,t,n)},t.prototype.loadNetwork=function(t){if(this.net&&this.net.layers.length==t.layers.length&&this.net.layers.every(function(n,e){return n.length==t.layers[e].length}))return this.net=t,void this.update();this.instantiateGraph(),this.net=t,this.nodes.clear(),this.edges.clear();for(var n=[],e=[],i=0;i<t.layers.length;i++)for(var o=t.layers[i],a=0;a<o.length;a++){var u=o[a],r="Hidden Neuron "+(a+1),s="#000";u instanceof Net.InputNeuron&&(r="Input: "+u.name,s=u.constant?NetworkVisualization.colors.autoencoder.bias:NetworkVisualization.colors.autoencoder.input),u instanceof Net.OutputNeuron&&(r="Output: "+u.name,s=NetworkVisualization.colors.autoencoder.output),n.push({id:u.id,label:""+r,level:i,color:s})}for(var p=0,h=t.connections;p<h.length;p++){var c=h[p];e.push({id:c.inp.id*t.connections.length+c.out.id,from:c.inp.id,to:c.out.id,arrows:"to",label:c.weight.toFixed(2)})}this.nodes.add(n),this.edges.add(e)},t.prototype.update=function(){for(var t=0,n=this.net.connections;t<n.length;t++){var e=n[t];this.edges.update({id:e.inp.id*this.net.connections.length+e.out.id,label:e.weight.toFixed(2),width:Math.min(6,Math.abs(2*e.weight)),color:e.weight>0?"blue":"red"})}},t}(),CanvasMouseNavigation=function(){function t(t,n,e){var i=this;this.scalex=100,this.scaley=-100,this.offsetx=0,this.offsety=0,this.mousedown=!1,this.mousestart={x:0,y:0},this.toReal={x:function(t){return(t-i.offsetx)/i.scalex},y:function(t){return(t-i.offsety)/i.scaley}},this.toCanvas={x:function(t){return t*i.scalex+i.offsetx},y:function(t){return t*i.scaley+i.offsety}},this.offsetx=t.width/3,this.offsety=2*t.height/3,t.addEventListener("wheel",function(t){if(0!==t.deltaY){var n=t.deltaY/Math.abs(t.deltaY);i.scalex*=1-n/10,i.scaley*=1-n/10,e(),t.preventDefault()}}),t.addEventListener("mousedown",function(t){n()&&(i.mousedown=!0,i.mousestart.x=t.pageX,i.mousestart.y=t.pageY)}),t.addEventListener("mousemove",function(t){n()&&i.mousedown&&(i.offsetx+=t.pageX-i.mousestart.x,i.offsety+=t.pageY-i.mousestart.y,i.mousestart.x=t.pageX,i.mousestart.y=t.pageY,e())}),document.addEventListener("mouseup",function(t){return i.mousedown=!1})}return t}(),InputMode;!function(t){t[t.InputPrimary=0]="InputPrimary",t[t.InputSecondary=1]="InputSecondary",t[t.Remove=2]="Remove",t[t.Move=3]="Move",t[t.Table=4]="Table"}(InputMode||(InputMode={}));var NetworkVisualization=function(){function t(t,n,e,i){this.canvas=t,this.trafo=n,this.sim=e,this.backgroundResolution=i,this.inputMode=0,this.ctx=this.canvas.getContext("2d"),this.canvasResized(),window.addEventListener("resize",this.canvasResized.bind(this)),t.addEventListener("click",this.canvasClicked.bind(this)),t.addEventListener("contextmenu",this.canvasClicked.bind(this))}return t.prototype.draw=function(){return 2!=this.sim.config.inputLayer.neuronCount||this.sim.config.outputLayer.neuronCount>2?(this.clear("white"),this.ctx.fillStyle="black",void this.ctx.fillText("Cannot draw this data",this.canvas.width/2,this.canvas.height/2)):(this.drawBackground(),this.drawCoordinateSystem(),void this.drawDataPoints())},t.prototype.drawDataPoints=function(){if(this.ctx.strokeStyle="#000",1===this.sim.config.outputLayer.neuronCount)for(var n=0,e=this.sim.config.data;n<e.length;n++){var i=e[n];this.drawPoint(i.input[0],i.input[1],t.colors.binaryClassify.fg[0|i.output[0]])}else{if(2!==this.sim.config.outputLayer.neuronCount)throw"can't draw this";for(var o=0,a=this.sim.config.data;o<a.length;o++){var i=a[o],u=i.input[0],r=i.input[1],s=this.sim.net.getOutput(i.input),p=s[0],h=s[1];this.drawLine(u,r,p,h,"black"),this.drawPoint(u,r,t.colors.autoencoder.input),this.drawPoint(p,h,t.colors.autoencoder.output)}}},t.prototype.drawLine=function(t,n,e,i,o){t=this.trafo.toCanvas.x(t),e=this.trafo.toCanvas.x(e),n=this.trafo.toCanvas.y(n),i=this.trafo.toCanvas.y(i),this.ctx.strokeStyle=o,this.ctx.beginPath(),this.ctx.moveTo(t,n),this.ctx.lineTo(e,i),this.ctx.stroke()},t.prototype.drawPoint=function(t,n,e){t=this.trafo.toCanvas.x(t),n=this.trafo.toCanvas.y(n),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(t,n,5,0,2*Math.PI),this.ctx.fill(),this.ctx.arc(t,n,5,0,2*Math.PI),this.ctx.stroke()},t.prototype.clear=function(t){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.drawBackground=function(){if(2===this.sim.config.outputLayer.neuronCount)return void this.clear("white");for(var n=0;n<this.canvas.width;n+=this.backgroundResolution)for(var e=0;e<this.canvas.height;e+=this.backgroundResolution){var i=this.sim.net.getOutput([this.trafo.toReal.x(n+this.backgroundResolution/2),this.trafo.toReal.y(e+this.backgroundResolution/2)])[0];this.sim.config.showGradient?this.ctx.fillStyle=t.colors.binaryClassify.gradient(i):this.ctx.fillStyle=t.colors.binaryClassify.bg[+(i>.5)],this.ctx.fillRect(n,e,this.backgroundResolution,this.backgroundResolution)}},t.prototype.drawCoordinateSystem=function(){var t=.2,n=this.ctx,e=this.trafo.toCanvas;n.strokeStyle="#000",n.fillStyle="#000",n.textBaseline="middle",n.textAlign="center",n.font="20px monospace",n.beginPath(),n.moveTo(e.x(0),0),n.lineTo(e.x(0),this.canvas.height),n.moveTo(e.x(-t/2),e.y(1)),n.lineTo(e.x(t/2),e.y(1)),n.fillText("1",e.x(-t),e.y(1)),n.moveTo(0,e.y(0)),n.lineTo(this.canvas.width,e.y(0)),n.moveTo(e.x(1),e.y(-t/2)),n.lineTo(e.x(1),e.y(t/2)),n.fillText("1",e.x(1),e.y(-t)),n.stroke()},t.prototype.canvasResized=function(){this.canvas.width=$(this.canvas).width(),this.canvas.height=$(this.canvas).height()},t.prototype.canvasClicked=function(t){var n=this.sim.config.data,e=this.canvas.getBoundingClientRect(),i=this.trafo.toReal.x(t.clientX-e.left),o=this.trafo.toReal.y(t.clientY-e.top);if(2==this.inputMode||2==t.button||t.shiftKey){for(var a=1/0,u=-1,r=0;r<n.length;r++){var s=n[r],p=s.input[0]-i,h=s.input[1]-o,c=p*p+h*h;a>c&&(u=r,a=c)}u>=0&&n.splice(u,1)}else if(this.inputMode<2)if(2===this.sim.config.outputLayer.neuronCount)n.push({input:[i,o],output:[i,o]});else if(1===this.sim.config.outputLayer.neuronCount){var l=function(t){return 0==t?1:0},d=this.inputMode;0!=t.button&&(d=l(d)),(t.ctrlKey||t.metaKey||t.altKey)&&(d=l(d)),n.push({input:[i,o],output:[d]})}this.sim.setIsCustom(!1),t.preventDefault(),this.draw()},t.colors={binaryClassify:{bg:["#f88","#8f8"],fg:["#f00","#0f0"],gradient:function(t){return"rgb("+[(196*(1-t)|0)+60,(196*t|0)+60,60]+")"}},autoencoder:{input:"#2188e0",output:"#ff931f",bias:"#008"}},t}(),Presets;!function(t){function n(){return a.map(function(t){return t.name}).filter(function(t){return"Default"!==t})}function e(t){return void 0!==a.filter(function(n){return n.name===t})[0]}function i(t){var n=[],e=a.filter(function(n){return n.name===t})[0];for(n.unshift(e);;){var i=e.parent||"Default";if(e=a.filter(function(t){return t.name===i})[0],n.unshift(e),"Default"===i)break}return n.unshift({}),console.log("loading chain="+n.map(function(t){return t.name})),JSON.parse(JSON.stringify($.extend.apply($,n)))}function o(t){void 0===t&&(t="Default");var n=i(t),e={};for(var o in sim.config)sim.config[o]!==n[o]&&(e[o]=sim.config[o]);return e}var a=[{name:"Default",stepsPerFrame:50,learningRate:.05,showGradient:!1,bias:!0,autoRestartTime:5e3,autoRestart:!1,iterationsPerClick:5e3,data:[{input:[0,0],output:[0]},{input:[0,1],output:[1]},{input:[1,0],output:[1]},{input:[1,1],output:[0]}],inputLayer:{neuronCount:2,names:["x","y"]},outputLayer:{neuronCount:1,activation:"sigmoid",names:["x XOR y"]},hiddenLayers:[{neuronCount:2,activation:"sigmoid"}]},{name:"Binary Classifier for XOR"},{name:"Binary Classifier for circular data",hiddenLayers:[{neuronCount:3,activation:"sigmoid"}],inputLayer:{neuronCount:2,names:["x","y"]},outputLayer:{neuronCount:1,activation:"sigmoid",names:["Class"]},data:[{input:[1.46,1.36],output:[0]},{input:[1.14,1.26],output:[0]},{input:[.96,.97],output:[0]},{input:[1.04,.76],output:[0]},{input:[1.43,.81],output:[0]},{input:[1.3,1.05],output:[0]},{input:[1.45,1.22],output:[0]},{input:[2.04,1.1],output:[0]},{input:[1.06,.28],output:[0]},{input:[.96,.57],output:[0]},{input:[1.28,.46],output:[0]},{input:[1.51,.33],output:[0]},{input:[1.65,.68],output:[0]},{input:[1.67,1.01],output:[0]},{input:[1.5,1.83],output:[1]},{input:[.76,1.69],output:[1]},{input:[.4,.71],output:[1]},{input:[.61,1.18],output:[1]},{input:[.26,1.42],output:[1]},{input:[.28,1.89],output:[1]},{input:[1.37,1.89],output:[1]},{input:[1.11,1.9],output:[1]},{input:[1.05,2.04],output:[1]},{input:[2.43,1.42],output:[1]},{input:[2.39,1.2],output:[1]},{input:[2.1,1.53],output:[1]},{input:[1.89,1.72],output:[1]},{input:[2.69,.72],output:[1]},{input:[2.96,.44],output:[1]},{input:[2.5,.79],output:[1]},{input:[2.85,1.23],output:[1]},{input:[2.82,1.37],output:[1]},{input:[1.93,1.9],output:[1]},{input:[2.18,1.77],output:[1]},{input:[2.29,.39],output:[1]},{input:[2.57,.22],output:[1]},{input:[2.7,-.11],output:[1]},{input:[1.96,-.2],output:[1]},{input:[1.89,-.1],output:[1]},{input:[1.77,.13],output:[1]},{input:[.73,.01],output:[1]},{input:[.37,.31],output:[1]},{input:[.46,.44],output:[1]},{input:[.48,.11],output:[1]},{input:[.37,-.1],output:[1]},{input:[1.03,-.42],output:[1]},{input:[1.35,-.25],output:[1]},{input:[1.17,.01],output:[1]},{input:[.12,.94],output:[1]},{input:[2.05,.32],output:[1]},{input:[1.97,.55],output:[0]}]},{name:"Auto-Encoder for linear data",stepsPerFrame:1,iterationsPerClick:1,parent:"Auto-Encoder for circular data",data:[{input:[2.25,.19],output:[2.25,.19]},{input:[1.37,.93],output:[1.37,.93]},{input:[.62,1.46],output:[.62,1.46]},{input:[-.23,2.16],output:[-.23,2.16]},{input:[-.55,2.44],output:[-.55,2.44]},{input:[1.04,1.05],output:[1.04,1.05]},{input:[1.7,.85],output:[1.7,.85]},{input:[2.01,.46],output:[2.01,.46]},{input:[.4,1.73],output:[.4,1.73]},{input:[2.73,.01],output:[2.73,.01]},{input:[2.86,-.25],output:[2.86,-.25]},{input:[.14,2.07],output:[.14,2.07]}],hiddenLayers:[{neuronCount:1,activation:"sigmoid"}],showGradient:!0},{name:"Auto-Encoder for x^2",parent:"Auto-Encoder for circular data",netLayers:[{activation:"sigmoid",neuronCount:2},{activation:"linear",neuronCount:1},{neuronCount:2,activation:"sigmoid"}],data:Array.apply(null,Array(17)).map(function(t,n){return(n-8)/8}).map(function(t){return{input:[t,t*t],output:[t,t*t]}})},{name:"Auto-Encoder for circular data",stepsPerFrame:500,learningRate:.01,iterationsPerClick:1e4,inputLayer:{neuronCount:2,names:["x","y"]},outputLayer:{neuronCount:2,activation:"linear",names:["x","y"]},hiddenLayers:[{activation:"sigmoid",neuronCount:3},{activation:"linear",neuronCount:1},{neuronCount:3,activation:"sigmoid"}],data:[{input:[-.83,.55],output:[-.83,.55]},{input:[-.98,.21],output:[-.98,.21]},{input:[-.77,-.64],output:[-.77,-.64]},{input:[.95,.31],output:[.95,.31]},{input:[-.86,-.51],output:[-.86,-.51]},{input:[.99,-.11],output:[.99,-.11]},{input:[.97,.24],output:[.97,.24]},{input:[.85,.52],output:[.85,.52]},{input:[-.99,.15],output:[-.99,.15]},{input:[.62,.78],output:[.62,.78]},{input:[.46,-.89],output:[.46,-.89]},{input:[-.68,-.73],output:[-.68,-.73]},{input:[.6,-.8],output:[.6,-.8]},{input:[.38,.92],output:[.38,.92]},{input:[.76,.65],output:[.76,.65]},{input:[.33,-.94],output:[.33,-.94]},{input:[-.99,-.17],output:[-.99,-.17]},{input:[-.99,-.17],output:[-.99,-.17]},{input:[-.97,-.26],output:[-.97,-.26]},{input:[-.79,-.61],output:[-.79,-.61]},{input:[-.03,-1],output:[-.03,-1]},{input:[.58,.81],output:[.58,.81]},{input:[-.67,-.74],output:[-.67,-.74]},{input:[.14,.99],output:[.14,.99]},{input:[.13,-.99],output:[.13,-.99]},{input:[.76,.65],output:[.76,.65]},{input:[-.49,.87],output:[-.49,.87]},{input:[-.28,.96],output:[-.28,.96]},{input:[.47,-.88],output:[.47,-.88]},{input:[-.03,1],output:[-.03,1]},{input:[-.7,.71],output:[-.7,.71]},{input:[.38,.93],output:[.38,.93]},{input:[.62,.79],output:[.62,.79]},{input:[.72,-.69],output:[.72,-.69]},{input:[-.41,-.91],output:[-.41,-.91]},{input:[.74,-.67],output:[.74,-.67]},{input:[.44,.9],output:[.44,.9]},{input:[-.99,-.16],output:[-.99,-.16]},{input:[.62,.78],output:[.62,.78]},{input:[.95,-.39],output:[.95,-.39]},{input:[.86,-.53],output:[.86,-.53]}]},{name:"Auto-Encoder 4D",learningRate:.05,data:[{input:[1,0,0,0],output:[1,0,0,0]},{input:[0,1,0,0],output:[0,1,0,0]},{input:[0,0,1,0],output:[0,0,1,0]},{input:[0,0,0,1],output:[0,0,0,1]}],inputLayer:{neuronCount:4,names:["in1","in2","in3","in4"]},outputLayer:{neuronCount:4,activation:"linear",names:["out1","out2","out3","out4"]},hiddenLayers:[{neuronCount:2,activation:"sigmoid"}],netLayers:[{activation:"sigmoid",neuronCount:2},{activation:"linear",neuronCount:1},{neuronCount:2,activation:"sigmoid"}]}];t.getNames=n,t.exists=e,t.get=i,t.printPreset=o}(Presets||(Presets={}));var LearnRateGraph=function(){function t(t,n){t.highcharts({title:{text:"Average error"},chart:{type:"line",animation:!1},plotOptions:{line:{marker:{enabled:!1}}},legend:{enabled:!1},yAxis:{min:0,title:{text:""},labels:{format:"{value:%.2f}"}},series:[{name:"Error",data:n}]}),this.chart=t.highcharts()}return t.prototype.clear=function(){this.chart.series[0].setData([])},t.prototype.addPoint=function(t,n){this.chart.series[0].addPoint([t,n],!0,!1)},t}(),Simulation=function(){function t(t){var n=this;this.backgroundResolution=10,this.stepNum=0,this.running=!1,this.runningId=-1,this.restartTimeout=-1,this.isCustom=!1,this.averageError=1,this.statusIterEle=document.getElementById("statusIteration"),this.statusCorrectEle=document.getElementById("statusCorrect"),this.aniFrameCallback=this.animationStep.bind(this);var e=$("#neuralInputOutput canvas")[0];this.netviz=new NetworkVisualization(e,new CanvasMouseNavigation(e,function(){return 3==n.netviz.inputMode},function(){return n.draw()}),this,this.backgroundResolution),this.netgraph=new NetworkGraph($("#neuralNetworkGraph")[0]),$("#learningRate").slider({min:.01,max:1,step:.005,scale:"logarithmic",value:.05}).on("change",function(t){return $("#learningRateVal").text(t.value.newValue.toFixed(3))}),this.neuronGui=new NeuronGui(this);for(var i=0,o=Presets.getNames();i<o.length;i++){var a=o[i];$("#presetLoader").append($("<li>").append($("<a>").text(a)))}$("#presetLoader").on("click","a",function(t){var e=t.target.textContent;n.loadPreset(e),n.initializeNet()}),$("#dataInputSwitch").on("click","a",function(t){$("#dataInputSwitch li.active").removeClass("active");var e=$(t.target).parent();e.addClass("active");var i=e.index(),o=n.netviz.inputMode==InputMode.Table!=(i==InputMode.Table);n.netviz.inputMode=i,o&&(i==InputMode.Table?($("#neuralInputOutput > *").detach(),$("#neuralInputOutput").append(n.table.container),n.table.loadData(n)):(n.table.reparseData(),$("#neuralInputOutput > *").detach(),$("#neuralInputOutput").append(n.netviz.canvas),n.draw()))});var u=function(){n.stop(),$("#urlExport").text(sim.serializeToUrl(+$("#exportWeights").val()))};$("#exportModal").on("shown.bs.modal",u),$("#exportModal select").on("change",u),this.deserializeFromUrl(),this.table=new TableEditor(this),t&&this.run()}return t.prototype.initializeNet=function(t){this.net&&this.stop(),this.errorHistory=[],this.learnrateGraph&&this.learnrateGraph.clear(),this.net=new Net.NeuralNet(this.config.inputLayer,this.config.hiddenLayers,this.config.outputLayer,this.config.learningRate,this.config.bias,void 0,t);var n=1===this.config.outputLayer.neuronCount;$("#dataInputSwitch > li").eq(1).toggle(n);var e=$("#dataInputSwitch > li > a").eq(0);e.text(n?"Add Red":"Add point"),n||1!=this.netviz.inputMode||e.click(),this.stepNum=0,this.netgraph.loadNetwork(this.net),this.table&&this.table.loadData(this),this.draw(),this.updateStatusLine()},t.prototype.step=function(){this.stepNum++;for(var t=0,n=this.config.data;t<n.length;t++){var e=n[t];this.net.train(e.input,e.output)}},t.prototype.draw=function(){this.netviz.inputMode===InputMode.Table?this.table.updateRealOutput():this.netviz.draw(),this.netgraph.update()},t.prototype.run=function(){this.running||($("#runButton").text("Stop").addClass("btn-danger").removeClass("btn-primary"),this.running=!0,this.animationStep())},t.prototype.stop=function(){clearTimeout(this.restartTimeout),$("#runButton").text("Run").addClass("btn-primary").removeClass("btn-danger"),this.restartTimeout=-1,this.running=!1,cancelAnimationFrame(this.runningId)},t.prototype.reset=function(){this.stop(),this.loadConfig(!0),this.initializeNet()},t.prototype.updateStatusLine=function(){var t=this,n=0;this.averageError=0;for(var e=0,i=this.config.data;e<i.length;e++){for(var o=i[e],a=this.net.getOutput(o.input),u=0,r=0;r<this.net.outputs.length;r++){var s=a[r]-o.output[r];u+=s*s}this.averageError+=Math.sqrt(u)}if(this.averageError/=this.config.data.length,1===this.config.outputLayer.neuronCount){for(var p=0,h=this.config.data;p<h.length;p++){var c=h[p],a=this.net.getOutput(c.input);+(a[0]>.5)==c.output[0]&&n++}this.statusCorrectEle.innerHTML="Correct: "+n+"/"+this.config.data.length}else this.statusCorrectEle.innerHTML="Avg. error: "+this.averageError.toFixed(2);this.errorHistory.push([this.stepNum,this.averageError]),this.learnrateGraph&&this.learnrateGraph.addPoint(this.stepNum,this.averageError),this.statusIterEle.innerHTML=this.stepNum.toString(),n==this.config.data.length?this.config.autoRestart&&this.running&&-1==this.restartTimeout&&(this.restartTimeout=setTimeout(function(){t.stop(),t.restartTimeout=-1,setTimeout(function(){t.reset(),t.run()},1e3)},this.config.autoRestartTime-1)):-1!=this.restartTimeout&&(clearTimeout(this.restartTimeout),this.restartTimeout=-1)},t.prototype.animationStep=function(){for(var t=0;t<this.config.stepsPerFrame;t++)this.step();this.draw(),this.updateStatusLine(),this.running&&(this.runningId=requestAnimationFrame(this.aniFrameCallback))},t.prototype.iterations=function(){this.stop();for(var t=0;t<this.config.iterationsPerClick;t++)this.step();this.draw(),this.updateStatusLine()},t.prototype.setIsCustom=function(t,n){if(void 0===n&&(n=!0),!this.isCustom||t){this.isCustom=!0,$("#presetName").text("Custom Network");var e=this.config.inputLayer;e.names=Net.Util.makeArray(e.neuronCount,function(t){return"in"+(t+1)}),e=this.config.outputLayer,e.names=Net.Util.makeArray(e.neuronCount,function(t){return"out"+(t+1)}),t&&this.table.createNewTable(this),n&&this.table.loadData(this)}},t.prototype.loadConfig=function(t){void 0===t&&(t=!1);var n=this.config,e=$.extend({},n);for(var i in n){var o=document.getElementById(i);o&&("checkbox"==o.type?n[i]=o.checked:"number"==typeof n[i]?n[i]=+o.value:n[i]=o.value)}e.simType!=n.simType&&(n.data=[]),this.net&&(this.net.learnRate=this.config.learningRate),t||this.setIsCustom(!0)},t.prototype.loadPreset=function(t){this.isCustom=!1,$("#presetName").text("Preset: "+t),this.config=Presets.get(t),this.table&&this.table.createNewTable(this),this.setConfig(),history.replaceState({},"","?"+$.param({preset:t}))},t.prototype.setConfig=function(){var t=this.config;for(var n in t){var e=document.getElementById(n);e&&("checkbox"==e.type?e.checked=t[n]:e.value=t[n])}$("#learningRate").slider("setValue",this.config.learningRate),$("#learningRateVal").text(this.config.learningRate.toFixed(3)),this.neuronGui.regenerate()},t.prototype.runtoggle=function(){this.running?this.stop():this.run()},t.prototype.showLearnrateGraph=function(){var t=$("<div>");$(this.netgraph.networkGraphContainer).children("*").detach(),$(this.netgraph.networkGraphContainer).append(t),this.learnrateGraph=new LearnRateGraph(t,this.errorHistory)},t.prototype.serializeToUrl=function(t){void 0===t&&(t=0);var n=location.protocol+"//"+location.host+location.pathname+"?",e={};return 1===t&&(e.weights=LZString.compressToBase64(JSON.stringify(this.net.connections.map(function(t){return t.weight})))),2===t&&(e.weights=LZString.compressToBase64(JSON.stringify(this.net.startWeights))),this.isCustom?e.config=LZString.compressToBase64(JSON.stringify(this.config)):e.preset=this.config.name,n+$.param(e)},t.prototype.deserializeFromUrl=function(){function t(t){var n=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);return n&&decodeURIComponent(n[1].replace(/\+/g," "))}var n=t("preset"),e=t("config");n&&Presets.exists(n)?this.loadPreset(n):e?(this.config=JSON.parse(LZString.decompressFromBase64(e)),this.setIsCustom(!0)):this.loadPreset("Binary Classifier for XOR");var i=t("weights");i?this.initializeNet(JSON.parse(LZString.decompressFromBase64(i))):this.initializeNet()},t}(),sim;$(document).ready(function(){return sim=new Simulation(!1)});
//# sourceMappingURL=program.min.js.map